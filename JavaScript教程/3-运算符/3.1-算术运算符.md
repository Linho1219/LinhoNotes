# 3.1 算术运算符

运算符是处理数据的基本方法，用来从现有的值得到新的值。JavaScript 提供了多种运算符，覆盖了所有主要的运算。

## 概述

JavaScript 共提供 10 个算术运算符，用来完成基本的算术运算。

- 加法/连接：`x + y`
- 减法： `x - y`
- 乘法： `x * y`
- 除法：`x / y`
- 指数：`x ** y`
- 余数：`x % y`
- 自增：`++x` 或者 `x++`
- 自减：`--x` 或者 `x--`
- 数值： `+x`
- 负数值：`-x`

减法、乘法、除法运算符没什么好说的，这里不展开。

## 加法/连接运算符

### 基本规则

加法运算符（`+`）是最常见的运算符，用来求两个数值的和。

```js
1 + 1; // 2
```

JavaScript 允许非数值的相加。

```js
true + true; // 2
1 + true; // 2
```

上面代码中，第一行是两个布尔值相加，第二行是数值与布尔值相加。这两种情况，布尔值都会自动转成数值，然后再相加。

如果是两个字符串相加，这时加法运算符会变成**连接运算符**，返回一个新的字符串，将两个原字符串连接在一起。

```js
"a" + "bc"; // "abc"
```

如果一个运算子是字符串，另一个运算子是非字符串，这时非字符串会转成字符串，再连接在一起。

```js
1 + "a"; // "1a"
false + "a"; // "falsea"
```

加法运算符是在运行时决定，到底是执行相加，还是执行连接。也就是说，运算子的不同，导致了不同的语法行为，这种现象称为「重载」（overload）。由于加法运算符存在重载，可能执行两种运算，使用的时候必须很小心。

```js
"3" + 4 + 5; // "345"
3 + 4 + "5"; // "75"
```

上面代码中，由于从左到右的运算次序，字符串的位置不同会导致不同的结果。

除了加法运算符，其他算术运算符（比如减法、除法和乘法）**都不会发生重载**。它们的规则是：所有运算子一律转为数值，再进行相应的数学运算。

```js
1 - "2"; // -1
1 * "2"; // 2
1 / "2"; // 0.5
```

如果对象相加，会触发一系列的强制类型转换，此处不展开。

```js
({}) + 1; // '[object Object]1'
```

> [!tip]
> 良好是实践是，当加号两边不是 `数字+数字` 或者 `字符串+字符串` 的时候，使用显式强制类型转换。

## 余数运算符

余数运算符（`%`）返回前一个数被后一个数除，所得的余数。

```js
12 % 5; // 2
```

需要注意的是，运算结果的正负号由第一个运算子的正负号决定。

```js
-1 % 2; // -1
1 % -2; // 1
```

所以，为了得到负数的正确余数值，可以先使用绝对值函数。

```js
// 错误
const isOdd = (n) => n % 2 === 1;

isOdd(-5); // false
isOdd(-4); // false

// 正确
const isOdd = (n) => Math.abs(n % 2) === 1;
isOdd(-5); // true
isOdd(-4); // false
```

余数运算符还可以用于浮点数的运算。但是，由于浮点数不是精确的值，无法得到完全准确的结果。

```js
6.5 % 2.1;
// 0.19999999999999973
```

## 自增和自减运算符

自增和自减运算符，是一元运算符，只需要一个运算子。它们的作用是将运算子首先转为数值，然后加上 1 或者减去 1。它们会修改原始变量。

```js
let x = 1;
++x; // 2
x; // 2

--x; // 1
x; // 1
```

上面代码的变量 `x` 自增后，返回 `2`，再进行自减，返回 `1`。这两种情况都会使得，原始变量 `x` 的值发生改变。

运算之后，变量的值发生变化，这种效应叫做运算的副作用（side effect）。自增和自减运算符是仅有的两个具有副作用的运算符，其他运算符都不会改变变量的值。

自增和自减运算符有一个需要注意的地方，就是放在变量之后，会先返回变量操作前的值，再进行自增/自减操作；放在变量之前，会先进行自增/自减操作，再返回变量操作后的值。

```js
let x = 1;
let y = 1;

x++; // 1
++y; // 2
```

上面代码中，`x` 是先返回当前值，然后自增，所以得到 `1`；`y` 是先自增，然后返回新的值，所以得到 `2`。

## 数值运算符与负数值运算符

数值运算符（`+`）同样使用加号，但它是一元运算符（只需要一个操作数），而加法运算符是二元运算符（需要两个操作数）。

数值运算符的作用在于可以将任何值转为数值（与 `Number` 函数的作用相同）。

```js
+true; // 1
+[]; // 0
+{}; // NaN
```

> [!tip]
> 为保证代码可读性，不要使用 `+` 进行强制类型转换。使用 `Number()`。

负数值运算符（`-`），也同样具有将一个值转为数值的功能，只不过得到的值正负相反。连用两个负数值运算符，等同于数值运算符。

```js
let x = 1;
-x; // -1
-(-x); // 1
```

上面代码最后一行的圆括号不可少，否则会变成自减运算符。

数值运算符号和负数值运算符，都会返回一个新的值，而不会改变原始变量的值。

## 指数运算符

指数运算符（`**`）完成指数运算，前一个数是底数，后一个数是指数。

```js
2 ** 4; // 16
```

注意，指数运算符是右结合，而不是左结合。即多个指数运算符连用时，先进行最右边的计算。

```js
// 相当于 2 ** (3 ** 2)
2 ** (3 ** 2);
// 512
```

上面代码中，由于指数运算符是右结合，所以先计算第二个指数运算符，而不是第一个。

> [!tip]
> 为保障代码可读性，指数运算符连用时请加上括号。

## 赋值运算符与算术运算符的结合

赋值运算符可以与算术运算符结合，形成变体。

```js
x += y; // 等同于 x = x + y
x -= y; // 等同于 x = x - y
x *= y; // 等同于 x = x * y
x /= y; // 等同于 x = x / y
x %= y; // 等同于 x = x % y
x **= y; // 等同于 x = x ** y
```
